!function(){"use strict";var t,e,n,r,f=function(t){var e=t,n=function(){return e};return{get:n,set:function(t){e=t},clone:function(){return f(n())}}},a=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=function(t){return function(){return t}},i=o(!1),s=o(!0),u=i,c=s,l=function(){return d},d=(r={fold:function(t,e){return t()},is:u,isSome:u,isNone:c,getOr:n=function(t){return t},getOrThunk:e=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:n,orThunk:e,map:l,ap:l,each:function(){},bind:l,flatten:l,exists:u,forall:c,filter:l,equals:t=function(t){return t.isNone()},equals_:t,toArray:function(){return[]},toString:o("none()")},Object.freeze&&Object.freeze(r),r),g=function(n){var t=function(){return n},e=function(){return a},r=function(t){return t(n)},a={fold:function(t,e){return e(n)},is:function(t){return n===t},isSome:c,isNone:u,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return g(t(n))},ap:function(t){return t.fold(l,function(t){return g(t(n))})},each:function(t){t(n)},bind:r,flatten:t,exists:r,forall:r,filter:function(t){return t(n)?a:d},equals:function(t){return t.is(n)},equals_:function(t,e){return t.fold(u,function(t){return e(n,t)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return a},m={some:g,none:l,from:function(t){return null==t?d:g(t)}},h=("function",function(t){return"function"===function(t){if(null===t)return"null";var e=typeof t;return"object"===e&&Array.prototype.isPrototypeOf(t)?"array":"object"===e&&String.prototype.isPrototypeOf(t)?"string":e}(t)}),p=function(t,e){for(var n=[],r=0,a=t.length;r<a;r++){var o=t[r];e(o,r,t)&&n.push(o)}return n},v=Array.prototype.slice,O=(h(Array.from)&&Array.from,Object.hasOwnProperty),y=function(t,e){return O.call(t,e)},P=function(t){return y(t,"start")&&y(t,"end")},x=function(t){return!y(t,"end")&&!y(t,"replacement")},T=function(t){return y(t,"replacement")},b=function(t){return e=t,n=function(t,e){return t.start.length===e.start.length?0:t.start.length>e.start.length?-1:1},(r=v.call(e,0)).sort(n),r;var e,n,r},k=function(t){return{inlinePatterns:b(p(t,P)),blockPatterns:b(p(t,x)),replacementPatterns:p(t,T)}},C=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],D=tinymce.util.Tools.resolve("tinymce.util.Delay"),S=tinymce.util.Tools.resolve("tinymce.util.VK"),A=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),N=tinymce.util.Tools.resolve("tinymce.util.Tools"),R=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(0===e.indexOf(r.start)&&(!r.end||e.lastIndexOf(r.end)===e.length-r.end.length))return r}},I=function(t){return t&&3===t.nodeType},j=function(t,e,n){var r=t.dom.createRng();r.setStart(e,n),r.setEnd(e,n),t.selection.setRng(r)},w=function(e,t,n){var r=e.selection.getRng();return m.from(function(t,e,n){if(!1!==e.collapsed){var r=e.startContainer,a=r.data,o=!0===n?1:0;if(3===r.nodeType){var i=function(t,e,n,r){var a,o,i,f,s,u;for(o=0;o<t.length;o++)if(void 0!==(a=t[o]).end&&(f=a,s=n,u=r,e.substr(s-f.end.length-u,f.end.length)===f.end)&&0<n-r-(i=a).end.length-i.start.length)return a}(t,a,e.startOffset,o);if(void 0!==i){var f=a.lastIndexOf(i.end,e.startOffset-o),s=a.lastIndexOf(i.start,f-i.end.length);if(f=a.indexOf(i.end,s+i.start.length),-1!==s){var u=document.createRange();u.setStart(r,s),u.setEnd(r,f+i.end.length);var c=R(t,u.toString());if(!(void 0===i||c!==i||r.data.length<=i.start.length+i.end.length))return{pattern:i,startOffset:s,endOffset:f}}}}}}(t,r,n)).map(function(t){return function(a,o,i,f){var s=N.isArray(i.pattern.format)?i.pattern.format:[i.pattern.format];if(0!==N.grep(s,function(t){var e=a.formatter.get(t);return e&&e[0].inline}).length)return a.undoManager.transact(function(){var t,e,n,r;t=o,e=i.pattern,n=i.endOffset,(t=0<(r=i.startOffset)?t.splitText(r):t).splitText(n-r+e.end.length),t.deleteData(0,e.start.length),t.deleteData(t.data.length-e.end.length,e.end.length),o=t,f&&a.selection.setCursorLocation(o.nextSibling,1),s.forEach(function(t){a.formatter.apply(t,{},o)})}),o}(e,r.startContainer,t,n)})},E=function(u,t,c){var e=u.selection.getRng(),l=e.startContainer;e.collapsed&&I(l)&&function(t,e,n){for(var r=0;r<t.length;r++){var a=n.lastIndexOf(t[r].start,e);if(-1!==a)return m.some({pattern:t[r],startOffset:a})}return m.none()}(t,e.startOffset,l.data).each(function(t){var e,n,r,a,o,i,f,s=c?m.some((e=l,r=(n=t).startOffset+n.pattern.start.length,a=e.data.slice(r,r+1),e.deleteData(r,1),a)):m.none();o=u,f=t,(i=l).deleteData(f.startOffset,f.pattern.start.length),o.insertContent(f.pattern.replacement),m.from(i.nextSibling).filter(I).each(function(t){t.insertData(0,i.data),o.dom.remove(i)}),s.each(function(t){return function(t,e){var n=t.selection.getRng(),r=n.startContainer;if(I(r)){var a=n.startOffset;r.insertData(a,e),j(t,r,a+e.length)}else{var o=t.dom.doc.createTextNode(e);n.insertNode(o),j(t,o,o.length)}}(u,t)})})},q=function(t,e,n){for(var r=0;r<t.length;r++)if(n(t[r],e))return!0},L=function(t,e){var n,r,a,o;n=t,r=e.replacementPatterns,E(n,r,!0),a=t,o=e.inlinePatterns,w(a,o,!0).each(function(t){var e=t.data.slice(-1);if(/[\u00a0 ]/.test(e)){t.deleteData(t.data.length-1,1);var n=a.dom.doc.createTextNode(e);a.dom.insertAfter(n,t.parentNode),j(a,n,1)}})},M=function(f,s){var e=[",",".",";",":","!","?"],n=[32];f.on("keydown",function(t){var e,n,r,a,o,i;13!==t.keyCode||S.modifierPressed(t)||(e=f,n=s.get(),r=e,a=n.replacementPatterns,E(r,a,!1),o=e,i=n.inlinePatterns,w(o,i,!1).each(function(t){j(o,t,t.data.length)}),function(t,e){var n,r,a,o,i,f,s,u,c,l,d;if(n=t.selection,r=t.dom,n.isCollapsed()&&(s=r.getParent(n.getStart(),"p"))){for(c=new A(s,s);i=c.next();)if(I(i)){o=i;break}if(o){if(!(u=R(e,o.data)))return;if(a=(l=n.getRng(!0)).startContainer,d=l.startOffset,o===a&&(d=Math.max(0,d-u.start.length)),N.trim(o.data).length===u.start.length)return;u.format&&(f=t.formatter.get(u.format))&&f[0].block&&(o.deleteData(0,u.start.length),t.formatter.apply(u.format,{},o),l.setStart(a,d),l.collapse(!0),n.setRng(l)),u.cmd&&t.undoManager.transact(function(){o.deleteData(0,u.start.length),t.execCommand(u.cmd)})}}}(e,n.blockPatterns))},!0),f.on("keyup",function(t){q(n,t,function(t,e){return t===e.keyCode&&!1===S.modifierPressed(e)})&&L(f,s.get())}),f.on("keypress",function(t){q(e,t,function(t,e){return t.charCodeAt(0)===e.charCode})&&D.setEditorTimeout(f,function(){L(f,s.get())})})};a.add("textpattern",function(t){var e,n,r,a,o,i=f((e=t.settings,a=(n=e,r="textpattern_patterns",y(n,r)?m.some(n[r]):m.none()).getOr(C),k(a)));return M(t,i),o=i,{setPatterns:function(t){o.set(k(t))},getPatterns:function(){return o.get().inlinePatterns.concat(o.get().blockPatterns,o.get().replacementPatterns)}}})}();