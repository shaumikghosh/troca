!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=tinymce.util.Tools.resolve("tinymce.util.VK"),T=function(e){return e.target_list},t=function(e){return e.rel_list},C=function(e){return e.link_class_list},M=T,O=t,R=function(e){return void 0!==t(e)},N=C,A=function(e){return"boolean"==typeof e.allow_unsafe_link_target&&e.allow_unsafe_link_target},r=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),s=tinymce.util.Tools.resolve("tinymce.Env"),L=tinymce.util.Tools.resolve("tinymce.util.Tools"),P=function(e,t){var n,o,i=["noopener"],a=e?e.split(/\s+/):[],l=function(e){return e.filter(function(e){return-1===L.inArray(i,e)})};return(a=t?(n=l(n=a)).length?n.concat(i):i:l(a)).length?(o=a,L.trim(o.sort().join(" "))):null},E=function(e,t){return t=t||e.selection.getNode(),S(t)?e.dom.select("a[href]",t)[0]:e.dom.getParent(t,"a[href]")},n=function(e){return e&&"A"===e.nodeName&&e.href},S=function(e){return e&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className)},I=function(a){return function(){a.undoManager.transact(function(){var e,t,n,o,i=a.selection.getNode();S(i)?(t=i,(o=(e=a).dom.select("img",t)[0])&&(n=e.dom.getParents(o,"a[href]",t)[0])&&(n.parentNode.insertBefore(o,n),e.dom.remove(n))):a.execCommand("unlink")})}},u=n,o=function(e){return 0<L.grep(e,n).length},K=E,U=P,i=tinymce.util.Tools.resolve("tinymce.util.Delay"),l=tinymce.util.Tools.resolve("tinymce.util.XHR"),D={},B=function(e,o,t){var i=function(e,n){return n=n||[],L.each(e,function(e){var t={text:e.text||e.title};e.menu?t.menu=i(e.menu):(t.value=e.value,o&&o(t)),n.push(t)}),n};return i(e,t||[])},F=function(t,e,n){var o=t.selection.getRng();i.setEditorTimeout(t,function(){t.windowManager.confirm(e,function(e){t.selection.setRng(o),n(e)})})},c=function(r,e){var t,s,o,f,n,i,a,l,u,c,d,v,m,g,h,x,p,k={},y=r.selection,b=r.dom,_=function(e){var t=o.find("#text");(!t.value()||e.lastControl&&t.value()===e.lastControl.text())&&t.value(e.control.text()),o.find("#href").value(e.control.value())},w=function(){s||!f||k.text||this.parent().parent().find("#text")[0].value(this.value())};p=y.getContent(),f=!(/</.test(p)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(p)||-1===p.indexOf("href="))),t=K(r),k.text=(h=r.selection,s=((x=t)?x.innerText||x.textContent:h.getContent({format:"text"})).replace(/\uFEFF/g,"")),k.href=t?b.getAttrib(t,"href"):"",t?k.target=b.getAttrib(t,"target"):"string"==typeof r.settings.default_link_target&&(k.target=r.settings.default_link_target),(d=b.getAttrib(t,"rel"))&&(k.rel=d),(d=b.getAttrib(t,"class"))&&(k.class=d),(d=b.getAttrib(t,"title"))&&(k.title=d),f&&(n={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){k.text=this.value()}}),e&&(i={type:"listbox",label:"Link list",values:B(e,function(e){e.value=r.convertURL(e.value||e.url,"href")},[{text:"None",value:""}]),onselect:_,value:r.convertURL(k.href,"href"),onPostRender:function(){i=this}}),g=r.settings,!1!==T(g)&&(void 0===M(r.settings)&&(m=[{text:"None",value:""},{text:"New window",value:"_blank"}],r.settings.target_list=m),l={name:"target",type:"listbox",label:"Target",values:B(M(r.settings))}),R(r.settings)&&(a={name:"rel",type:"listbox",label:"Rel",values:B(O(r.settings),function(e){!1===A(r.settings)&&(e.value=U(e.value,"_blank"===k.target))})}),v=r.settings,void 0!==C(v)&&(u={name:"class",type:"listbox",label:"Class",values:B(N(r.settings),function(e){e.value&&(e.textStyle=function(){return r.formatter.getCssText({inline:"a",classes:[e.value]})})})}),!1!==r.settings.link_title&&(c={name:"title",type:"textbox",label:"Title",value:k.title}),o=r.windowManager.open({title:"Insert link",data:k,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:function(e){var t=e.meta||{};i&&i.value(r.convertURL(this.value(),"href")),L.each(e.meta,function(e,t){var n=o.find("#"+t);"text"===t?0===s.length&&(n.value(e),k.text=e):n.value(e)}),t.attach&&(D={href:this.value(),attach:t.attach}),t.text||w.call(this)},onkeyup:w,onpaste:w,onbeforecall:function(e){e.meta=o.toJSON()}},n,c,function(n){var o=[];if(L.each(r.dom.select("a:not([href])"),function(e){var t=e.name||e.id;t&&o.push({text:t,value:"#"+t,selected:-1!==n.indexOf("#"+t)})}),o.length)return o.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:o,onselect:_}}(k.href),i,a,l,u],onSubmit:function(e){var u,c,t,n="boolean"==typeof(t=r.settings).link_assume_external_targets&&t.link_assume_external_targets,o=(u=r,c=D,function(s){u.undoManager.transact(function(){var e,t,n,o,i,a=u.selection.getNode(),l=E(u,a),r={href:s.href,target:s.target?s.target:null,rel:s.rel?s.rel:null,class:s.class?s.class:null,title:s.title?s.title:null};R(u.settings)||!1!==A(u.settings)||(r.rel=P(r.rel,"_blank"===r.target)),s.href===c.href&&(c.attach(),c={}),l?(u.focus(),s.hasOwnProperty("text")&&("innerText"in l?l.innerText=s.text:l.textContent=s.text),u.dom.setAttribs(l,r),u.selection.select(l),u.undoManager.add()):S(a)?(t=a,n=r,(i=(e=u).dom.select("img",t)[0])&&(o=e.dom.create("a",n),i.parentNode.insertBefore(o,i),o.appendChild(i))):s.hasOwnProperty("text")?u.insertContent(u.dom.createHTML("a",r,u.dom.encode(s.text))):u.execCommand("mceInsertLink",!1,r)})}),i=I(r),a=L.extend({},k,e.data),l=a.href;l?(f&&a.text!==s||delete a.text,0<l.indexOf("@")&&-1===l.indexOf("//")&&-1===l.indexOf("mailto:")?F(r,"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(e){e&&(a.href="mailto:"+l),o(a)}):!0===n&&!/^\w+:/i.test(l)||!1===n&&/^\s*www[\.|\d\.]/i.test(l)?F(r,"The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(e){e&&(a.href="http://"+l),o(a)}):o(a)):i()}})},f=function(e,t){return e.dom.getParent(t,"a[href]")},d=function(e){return f(e,e.selection.getStart())},v=function(e,t){if(t){var n=(i=t).getAttribute("data-mce-href")||i.getAttribute("href");if(/^#/.test(n)){var o=e.$(n);o.length&&e.selection.scrollIntoView(o[0],!0)}else!function(e){if(!s.ie||10<s.ie){var t=document.createElement("a");t.target="_blank",t.href=e,t.rel="noreferrer noopener";var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a=t,l=n,document.body.appendChild(a),a.dispatchEvent(l),document.body.removeChild(a)}else{var o=window.open("","_blank");if(o){o.opener=null;var i=o.document;i.open(),i.write('<meta http-equiv="refresh" content="0; url='+r.DOM.encode(e)+'">'),i.close()}}var a,l}(t.href)}var i},m=function(o){return function(){var t,n,e;n=c,"string"==typeof(e=(t=o).settings.link_list)?l.send({url:e,success:function(e){n(t,JSON.parse(e))}}):"function"==typeof e?e(function(e){n(t,e)}):n(t,e)}},g=function(e){return function(){v(e,d(e))}},h=function(n){return function(){var t=this;n.on("nodechange",function(e){t.active(!n.readonly&&!!K(n,e.element))})}},x=function(e){var n;e.addMenuItem("openlink",{text:"Open link",icon:"newtab",onclick:g(e),onPostRender:(n=e,function(){var t=this,e=function(e){o(e.parents)?t.show():t.hide()};o(n.dom.getParents(n.selection.getStart()))||t.hide(),n.on("nodechange",e),t.on("remove",function(){n.off("nodechange",e)})}),prependToContext:!0}),e.addMenuItem("link",{icon:"link",text:"Link",shortcut:"Meta+K",onclick:m(e),stateSelector:"a[href]",context:"insert",prependToContext:!0}),e.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onclick:I(e),stateSelector:"a[href]"})},p=function(e){var l;e.addContextToolbar&&e.addContextToolbar((l=e,function(e){var t,n,o,i,a;return!!("boolean"==typeof(a=l.settings).link_context_toolbar&&a.link_context_toolbar&&(!(i=l.plugins.contextmenu)||!i.isContextMenuVisible())&&u(e)&&3===(o=(n=(t=l.selection).getRng()).startContainer).nodeType&&t.isCollapsed()&&0<n.startOffset&&n.startOffset<o.data.length)}),"openlink | link unlink")};e.add("link",function(e){var t,n,o,i;(i=e).addButton("link",{active:!1,icon:"link",tooltip:"Insert/edit link",onclick:m(i),onpostrender:h(i)}),i.addButton("unlink",{active:!1,icon:"unlink",tooltip:"Remove link",onclick:I(i),onpostrender:h(i)}),i.addContextToolbar&&i.addButton("openlink",{icon:"newtab",tooltip:"Open link",onclick:g(i)}),x(e),p(e),(o=e).on("click",function(e){var t=f(o,e.target);t&&a.metaKeyPressed(e)&&(e.preventDefault(),v(o,t))}),o.on("keydown",function(e){var t,n=d(o);n&&13===e.keyCode&&!0===(t=e).altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey&&(e.preventDefault(),v(o,n))}),(n=e).addCommand("mceLink",m(n)),(t=e).addShortcut("Meta+K","",m(t))})}();