!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),d=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),p=tinymce.util.Tools.resolve("tinymce.EditorManager"),v=tinymce.util.Tools.resolve("tinymce.Env"),y=tinymce.util.Tools.resolve("tinymce.util.Tools"),_=function(e){return e.getParam("importcss_selector_converter")},n=function(t){return"string"==typeof t?function(e){return-1!==e.indexOf(t)}:t instanceof RegExp?function(e){return t.test(e)}:t},r=function(m,e,f){var g=[],n={};y.each(m.contentCSS,function(e){n[e]=!0}),f||(f=function(e,t){return t||n[e]});try{y.each(e.styleSheets,function(e){!function t(e,n){var r,i,s,c=e.href;if(i=c,s=v.cacheSuffix,"string"==typeof i&&(i=i.replace("?"+s,"").replace("&"+s,"")),(c=i)&&f(c,n)&&(l=c,!(u=!1!==(a=(o=m).settings).skin&&(a.skin||"lightgray"))||l!==(a.skin_url?o.documentBaseURI.toAbsolute(a.skin_url):p.baseURL+"/skins/"+u)+"/content"+(o.inline?".inline":"")+".min.css")){var o,l,a,u;y.each(e.imports,function(e){t(e,!0)});try{r=e.cssRules||e.rules}catch(e){}y.each(r,function(e){e.styleSheet?t(e.styleSheet,!0):e.selectorText&&y.each(e.selectorText.split(","),function(e){g.push(y.trim(e))})})}}(e)})}catch(e){}return g},x=function(e,t){var n,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(r){var i=r[1],s=r[2].substr(1).split(".").join(" "),c=y.makeMap("a,img");return r[1]?(n={title:t},e.schema.getTextBlockElements()[i]?n.block=i:e.schema.getBlockElements()[i]||c[i.toLowerCase()]?n.selector=i:n.inline=i):r[2]&&(n={inline:"span",title:t.substr(1),classes:s}),!1!==e.getParam("importcss_merge_classes")?n.classes=s:n.attributes={class:s},n}},T=function(e,t){return null===t||!1!==e.getParam("importcss_exclusive")},i=x;e.add("importcss",function(e){return(h=e).on("renderFormatsMenu",function(e){var t,p={},s=n(h.getParam("importcss_selector_filter")),v=e.control,c=(t=h.getParam("importcss_groups"),y.map(t,function(e){return y.extend({},e,{original:e,selectors:{},filter:n(e.filter),item:{text:e.title,menu:[]}})})),o=function(e,t){if(m=e,g=p,!(T(h,f=t)?m in g:m in f.selectors)){l=e,u=p,T(h,a=t)?u[l]=!0:a.selectors[l]=!0;var n=(s=(i=h).plugins.importcss,c=e,((o=t)&&o.selector_converter?o.selector_converter:_(i)?_(i):function(){return x(i,c)}).call(s,c,o));if(n){var r=n.name||d.DOM.uniqueId();return h.formatter.register(r,n),y.extend({},v.settings.itemDefaults,{text:n.title,format:r})}}var i,s,c,o,l,a,u,m,f,g;return null};h.getParam("importcss_append")||v.items().remove(),y.each(r(h,e.doc||h.getDoc(),n(h.getParam("importcss_file_filter"))),function(n){if(-1===n.indexOf(".mce-")&&(!s||s(n))){var e=(r=c,i=n,y.grep(r,function(e){return!e.filter||e.filter(i)}));if(0<e.length)y.each(e,function(e){var t=o(n,e);t&&e.item.menu.push(t)});else{var t=o(n,null);t&&v.add(t)}}var r,i}),y.each(c,function(e){0<e.item.menu.length&&v.add(e.item)}),e.control.renderNew()}),t=e,{convertSelectorToFormat:function(e){return i(t,e)}};var t,h})}();