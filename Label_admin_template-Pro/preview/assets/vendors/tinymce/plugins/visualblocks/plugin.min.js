!function(){"use strict";var m=function(e){var t=e,o=function(){return t};return{get:o,set:function(e){t=e},clone:function(){return m(o())}}},e=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),a=tinymce.util.Tools.resolve("tinymce.util.Tools"),u=c.DOM.uniqueId(),d=function(e,t,o){var n,s,i=e.dom,l=e.settings.visualblocks_content_css;(function(e,t){var o=a.toArray(e.getElementsByTagName("link"));if(0===a.grep(o,function(e){return e.id===u}).length){var n=c.DOM.create("link",{id:u,rel:"stylesheet",href:t});e.getElementsByTagName("head")[0].appendChild(n)}})(e.getDoc(),l||t+"/css/visualblocks.css"),i.toggleClass(e.getBody(),"mce-visualblocks"),o.set(!o.get()),n=e,s=o.get(),n.fire("VisualBlocks",{state:s})},v=function(o,n){return function(e){var t=e.control;t.active(n.get()),o.on("VisualBlocks",function(e){t.active(e.state)})}};e.add("visualblocks",function(e,t){var o,n,s,i,l,c,a,u,r=m(!1);a=t,u=r,(c=e).addCommand("mceVisualBlocks",function(){d(c,a,u)}),l=r,(i=e).addButton("visualblocks",{active:!1,title:"Show blocks",cmd:"mceVisualBlocks",onPostRender:v(i,l)}),i.addMenuItem("visualblocks",{text:"Show blocks",cmd:"mceVisualBlocks",onPostRender:v(i,l),selectable:!0,context:"view",prependToContext:!0}),n=t,s=r,(o=e).on("PreviewFormats AfterPreviewFormats",function(e){s.get()&&o.dom.toggleClass(o.getBody(),"mce-visualblocks","afterpreviewformats"===e.type)}),o.on("init",function(){o.getParam("visualblocks_default_state",!1)&&d(o,n,s)}),o.on("remove",function(){o.dom.removeClass(o.getBody(),"mce-visualblocks")})})}();