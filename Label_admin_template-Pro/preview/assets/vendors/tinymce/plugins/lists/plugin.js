!function(){"use strict";var e,t,n,r,o,i,u,a,s=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),f=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),l=tinymce.util.Tools.resolve("tinymce.util.VK"),p=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),v=tinymce.util.Tools.resolve("tinymce.util.Tools"),d=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),m=function(e){return e&&"BR"===e.nodeName},g=function(e){return e&&3===e.nodeType},h=function(e){return e&&/^(OL|UL|DL)$/.test(e.nodeName)},y=function(e){return e&&/^(OL|UL)$/.test(e.nodeName)},N=function(e){return e&&/^(DT|DD)$/.test(e.nodeName)},S=function(e){return e&&/^(LI|DT|DD)$/.test(e.nodeName)},C=function(e){return e&&/^(TH|TD)$/.test(e.nodeName)},O=m,b=function(e,t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]},T=function(e,t){return e&&e.nodeName in t},D=function(e,t){return!!m(t)&&!(!e.isBlock(t.nextSibling)||m(t.previousSibling))},L=function(e,t,n){var r=e.isEmpty(t);return!(n&&0<e.select("span[data-mce-type=bookmark]",t).length)&&r},E=function(e,t){return e.isChildOf(t,e.getRoot())},k=function(e,t){if(g(e))return{container:e,offset:t};var n=c.getNode(e,t);return g(n)?{container:n,offset:t>=e.childNodes.length?n.data.length:0}:n.previousSibling&&g(n.previousSibling)?{container:n.previousSibling,offset:n.previousSibling.data.length}:n.nextSibling&&g(n.nextSibling)?{container:n.nextSibling,offset:0}:{container:e,offset:t}},w=function(e){var t=e.cloneRange(),n=k(e.startContainer,e.startOffset);t.setStart(n.container,n.offset);var r=k(e.endContainer,e.endOffset);return t.setEnd(r.container,r.offset),t},A=d.DOM,x=function(o){var i={},e=function(e){var t,n,r;n=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"],1===n.nodeType&&(t=A.create("span",{"data-mce-type":"bookmark"}),n.hasChildNodes()?(r=Math.min(r,n.childNodes.length-1),e?n.insertBefore(t,n.childNodes[r]):A.insertAfter(t,n.childNodes[r])):n.appendChild(t),n=t,r=0),i[e?"startContainer":"endContainer"]=n,i[e?"startOffset":"endOffset"]=r};return e(!0),o.collapsed||e(),i},R=function(o){function e(e){var t,n,r;t=r=o[e?"startContainer":"endContainer"],n=o[e?"startOffset":"endOffset"],t&&(1===t.nodeType&&(n=function(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t===e)return n;1===t.nodeType&&"bookmark"===t.getAttribute("data-mce-type")||n++,t=t.nextSibling}return-1}(t),t=t.parentNode,A.remove(r),!t.hasChildNodes()&&A.isBlock(t)&&t.appendChild(A.create("br"))),o[e?"startContainer":"endContainer"]=t,o[e?"startOffset":"endOffset"]=n)}e(!0),e();var t=A.createRng();return t.setStart(o.startContainer,o.startOffset),o.endContainer&&t.setEnd(o.endContainer,o.endOffset),w(t)},I=function(e){return function(){return e}},_=function(n){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!n.apply(null,e)}},B=I(!1),P=I(!0),M=B,U=P,F=function(){return j},j=(r={fold:function(e,t){return e()},is:M,isSome:M,isNone:U,getOr:n=function(e){return e},getOrThunk:t=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:function(){return null},getOrUndefined:function(){},or:n,orThunk:t,map:F,ap:F,each:function(){},bind:F,flatten:F,exists:M,forall:U,filter:F,equals:e=function(e){return e.isNone()},equals_:e,toArray:function(){return[]},toString:I("none()")},Object.freeze&&Object.freeze(r),r),H=function(n){var e=function(){return n},t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:U,isNone:M,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:t,orThunk:t,map:function(e){return H(e(n))},ap:function(e){return e.fold(F,function(e){return H(e(n))})},each:function(e){e(n)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(n)?o:j},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(M,function(e){return t(n,e)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},$={some:H,none:F,from:function(e){return null==e?j:H(e)}},q=function(t){return function(e){return function(e){if(null===e)return"null";var t=typeof e;return"object"===t&&Array.prototype.isPrototypeOf(e)?"array":"object"===t&&String.prototype.isPrototypeOf(e)?"string":t}(e)===t}},W=q("string"),z=q("boolean"),K=q("function"),V=q("number"),X=function(e,t){for(var n=e.length,r=new Array(n),o=0;o<n;o++){var i=e[o];r[o]=t(i,o,e)}return r},Q=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n,e)},Y=function(e,t){for(var n=[],r=0,o=e.length;r<o;r++){var i=e[r];t(i,r,e)&&n.push(i)}return n},G=function(e,t,n){return Q(e,function(e){n=t(n,e)}),n},J=function(e,t){for(var n=0,r=e.length;n<r;n++){var o=e[n];if(t(o,n,e))return $.some(o)}return $.none()},Z=Array.prototype.push,ee=function(e,t){return function(e){for(var t=[],n=0,r=e.length;n<r;++n){if(!Array.prototype.isPrototypeOf(e[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+e);Z.apply(t,e[n])}return t}(X(e,t))},te=Array.prototype.slice,ne=function(e){return 0===e.length?$.none():$.some(e[0])},re=function(e){return 0===e.length?$.none():$.some(e[e.length-1])},oe=(K(Array.from)&&Array.from,"undefined"!=typeof window?window:Function("return this;")()),ie=function(e,t){return function(e,t){for(var n=null!=t?t:oe,r=0;r<e.length&&null!=n;++r)n=n[e[r]];return n}(e.split("."),t)},ue=function(e,t){var n=ie(e,t);if(null==n)throw e+" not available on this browser";return n},ae=function(e){var t,n=ie("ownerDocument.defaultView",e);return(t=n,ue("HTMLElement",t)).prototype.isPrototypeOf(e)},se=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),ce=function(e){var t=e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",le(e,t))},fe=function(e){var n,t,r,o=e.selection.getSelectedBlocks();return v.grep((n=e,t=o,r=v.map(t,function(e){var t=n.dom.getParent(e,"li,dd,dt",le(n,e));return t||e}),se.unique(r)),function(e){return S(e)})},le=function(e,t){var n=e.dom.getParents(t,"TD,TH");return 0<n.length?n[0]:e.getBody()},de=function(e,t){var n=e.dom.getParents(t,"ol,ul",le(e,t));return re(n)},me=function(t,e){var n=X(e,function(e){return de(t,e).getOr(e)});return se.unique(n)},ge={isList:function(e){var t=ce(e);return ae(t)},getParentList:ce,getSelectedSubLists:function(e){var t,n,r,o=ce(e),i=e.selection.getSelectedBlocks();return r=i,(n=o)&&1===r.length&&r[0]===n?(t=o,v.grep(t.querySelectorAll("ol,ul,dl"),function(e){return h(e)})):v.grep(i,function(e){return h(e)&&o!==e})},getSelectedListItems:fe,getClosestListRootElm:le,getSelectedDlItems:function(e){return Y(fe(e),N)},getSelectedListRoots:function(e){var t,n,r,o=(n=de(t=e,t.selection.getStart()),r=Y(t.selection.getSelectedBlocks(),y),n.toArray().concat(r));return me(e,o)}},pe=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:I(e)}},ve={fromHtml:function(e,t){var n=(t||document).createElement("div");if(n.innerHTML=e,!n.hasChildNodes()||1<n.childNodes.length)throw console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return pe(n.childNodes[0])},fromTag:function(e,t){var n=(t||document).createElement(e);return pe(n)},fromText:function(e,t){var n=(t||document).createTextNode(e);return pe(n)},fromDom:pe,fromPoint:function(e,t,n){var r=e.dom();return $.from(r.elementFromPoint(t,n)).map(pe)}},he=function(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];if(!o.isSome())return $.none();n.push(o.getOrDie())}return $.some(t.apply(null,n))},ye=Object.keys,Ne=function(){return ue("Node")},Se=function(e,t,n){return 0!=(e.compareDocumentPosition(t)&n)},Ce=function(e,t){return Se(e,t,Ne().DOCUMENT_POSITION_CONTAINED_BY)},Oe=function(){return be(0,0)},be=function(e,t){return{major:e,minor:t}},Te={nu:be,detect:function(e,t){var n=String(t).toLowerCase();return 0===e.length?Oe():function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.test(t))return r}}(e,t);if(!n)return{major:0,minor:0};var r=function(e){return Number(t.replace(n,"$"+e))};return be(r(1),r(2))}(e,n)},unknown:Oe},De="Firefox",Le=function(e,t){return function(){return t===e}},Ee=function(e){var t=e.current;return{current:t,version:e.version,isEdge:Le("Edge",t),isChrome:Le("Chrome",t),isIE:Le("IE",t),isOpera:Le("Opera",t),isFirefox:Le(De,t),isSafari:Le("Safari",t)}},ke={unknown:function(){return Ee({current:void 0,version:Te.unknown()})},nu:Ee,edge:I("Edge"),chrome:I("Chrome"),ie:I("IE"),opera:I("Opera"),firefox:I(De),safari:I("Safari")},we="Windows",Ae="Android",xe="Solaris",Re="FreeBSD",Ie=function(e,t){return function(){return t===e}},_e=function(e){var t=e.current;return{current:t,version:e.version,isWindows:Ie(we,t),isiOS:Ie("iOS",t),isAndroid:Ie(Ae,t),isOSX:Ie("OSX",t),isLinux:Ie("Linux",t),isSolaris:Ie(xe,t),isFreeBSD:Ie(Re,t)}},Be={unknown:function(){return _e({current:void 0,version:Te.unknown()})},nu:_e,windows:I(we),ios:I("iOS"),android:I(Ae),linux:I("Linux"),osx:I("OSX"),solaris:I(xe),freebsd:I(Re)},Pe=function(e,t){var n=String(t).toLowerCase();return J(e,function(e){return e.search(n)})},Me=function(e,n){return Pe(e,n).map(function(e){var t=Te.detect(e.versionRegexes,n);return{current:e.name,version:t}})},Ue=function(e,n){return Pe(e,n).map(function(e){var t=Te.detect(e.versionRegexes,n);return{current:e.name,version:t}})},Fe=function(e,t){return-1!==e.indexOf(t)},je=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,He=function(t){return function(e){return Fe(e,t)}},$e=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return Fe(e,"edge/")&&Fe(e,"chrome")&&Fe(e,"safari")&&Fe(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,je],search:function(e){return Fe(e,"chrome")&&!Fe(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return Fe(e,"msie")||Fe(e,"trident")}},{name:"Opera",versionRegexes:[je,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:He("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:He("firefox")},{name:"Safari",versionRegexes:[je,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(Fe(e,"safari")||Fe(e,"mobile/"))&&Fe(e,"applewebkit")}}],qe=[{name:"Windows",search:He("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return Fe(e,"iphone")||Fe(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:He("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:He("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:He("linux"),versionRegexes:[]},{name:"Solaris",search:He("sunos"),versionRegexes:[]},{name:"FreeBSD",search:He("freebsd"),versionRegexes:[]}],We={browsers:I($e),oses:I(qe)},ze=function(e){var t,n,r,o,i,u,a,s,c,f,l,d=We.browsers(),m=We.oses(),g=Me(d,e).fold(ke.unknown,ke.nu),p=Ue(m,e).fold(Be.unknown,Be.nu);return{browser:g,os:p,deviceType:(n=g,r=e,o=(t=p).isiOS()&&!0===/ipad/i.test(r),i=t.isiOS()&&!o,u=t.isAndroid()&&3===t.version.major,a=t.isAndroid()&&4===t.version.major,s=o||u||a&&!0===/mobile/i.test(r),c=t.isiOS()||t.isAndroid(),f=c&&!s,l=n.isSafari()&&t.isiOS()&&!1===/safari/i.test(r),{isiPad:I(o),isiPhone:I(i),isTablet:I(s),isPhone:I(f),isTouch:I(c),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:I(l)})}},Ke={detect:(o=function(){var e=navigator.userAgent;return ze(e)},u=!1,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return u||(u=!0,i=o.apply(null,e)),i})},Ve=(Node.ATTRIBUTE_NODE,Node.CDATA_SECTION_NODE,Node.COMMENT_NODE,Node.DOCUMENT_NODE,Node.DOCUMENT_TYPE_NODE,Node.DOCUMENT_FRAGMENT_NODE,Node.ELEMENT_NODE),Xe=(Node.TEXT_NODE,Node.PROCESSING_INSTRUCTION_NODE,Node.ENTITY_REFERENCE_NODE,Node.ENTITY_NODE,Node.NOTATION_NODE,Ve),Qe=function(e,t){return e.dom()===t.dom()},Ye=Ke.detect().browser.isIE()?function(e,t){return Ce(e.dom(),t.dom())}:function(e,t){var n=e.dom(),r=t.dom();return n!==r&&n.contains(r)},Ge=function(e,t){var n=e.dom();if(n.nodeType!==Xe)return!1;if(void 0!==n.matches)return n.matches(t);if(void 0!==n.msMatchesSelector)return n.msMatchesSelector(t);if(void 0!==n.webkitMatchesSelector)return n.webkitMatchesSelector(t);if(void 0!==n.mozMatchesSelector)return n.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},Je=function(e){var t=e.dom();return $.from(t.parentNode).map(ve.fromDom)},Ze=function(e){var t=e.dom();return X(t.childNodes,ve.fromDom)},et=function(e,t){var n=e.dom().childNodes;return $.from(n[t]).map(ve.fromDom)},tt=function(e){return et(e,0)},nt=function(e){return et(e,e.dom().childNodes.length-1)},rt=(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}("element","offset"),function(t,n){Je(t).each(function(e){e.dom().insertBefore(n.dom(),t.dom())})}),ot=function(e,t){e.dom().appendChild(t.dom())},it=function(t,e){Q(e,function(e){ot(t,e)})},ut=function(e){var t=e.dom();null!==t.parentNode&&t.parentNode.removeChild(t)},at=function(e){return e.dom().nodeName.toLowerCase()},st=function(e,t){var n=e.dom();!function(e,t){for(var n=ye(e),r=0,o=n.length;r<o;r++){var i=n[r];t(e[i],i,e)}}(t,function(e,t){!function(e,t,n){if(!(W(n)||z(n)||V(n)))throw console.error("Invalid call to Attr.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")}(n,t,e)})},ct=function(e){return G(e.dom().attributes,function(e,t){return e[t.name]=t.value,e},{})},ft=function(e,t,n){!function(e,t,n){if(!W(n))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",n,":: Element ",e),new Error("CSS value must be a string: "+n);void 0!==e.style&&e.style.setProperty(t,n)}(e.dom(),t,n)},lt=function(e){return t=e,n=!0,ve.fromDom(t.dom().cloneNode(n));var t,n},dt=function(e,t){var n,r,o,i,u=(n=e,r=t,o=ve.fromTag(r),i=ct(n),st(o,i),o);rt(e,u);var a=Ze(e);return it(u,a),ut(e),u},mt=function(e,t){ot(e.item,t.list)},gt=function(f,e,l){var t=e.slice(0,l.depth);return re(t).each(function(e){var t,n,r,o,i,u,a,s,c=(t=f,n=l.itemAttributes,r=l.content,o=ve.fromTag("li",t),st(o,n),it(o,r),o);u=c,ot((i=e).list,u),i.item=u,s=l,at((a=e).list)!==s.listType&&(a.list=dt(a.list,s.listType)),st(a.list,s.listAttributes)}),t},pt=function(e,t,n){var r,o=function(e,t,n){for(var r,o,i,u=[],a=0;a<n;a++)u.push((r=e,o=t.listType,i={list:ve.fromTag(o,r),item:ve.fromTag("li",r)},ot(i.list,i.item),i));return u}(e,n,n.depth-t.length);return function(e){for(var t=1;t<e.length;t++)mt(e[t-1],e[t])}(o),function(e,t){for(var n=0;n<e.length-1;n++)ft(e[n].item,"list-style-type","none");re(e).each(function(e){st(e.list,t.listAttributes),st(e.item,t.itemAttributes),it(e.item,t.content)})}(o,n),r=o,he([re(t),ne(r)],mt),t.concat(o)},vt=function(e){return Ge(e,"OL,UL")},ht=function(e){return tt(e).map(vt).getOr(!1)},yt=function(e){return 0<e.depth},Nt=function(e){return e.isSelected},St=function(e){var t=Ze(e),n=nt(e).map(vt).getOr(!1)?t.slice(0,-1):t;return X(n,lt)},Ct=Object.prototype.hasOwnProperty,Ot=(a=function(e,t){return t},function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var n={},r=0;r<e.length;r++){var o=e[r];for(var i in o)Ct.call(o,i)&&(n[i]=a(n[i],o[i]))}return n}),bt=function(t){Q(t,function(r,e){(function(e,t){for(var n=e[t].depth,r=t-1;0<=r;r--){if(e[r].depth===n)return $.some(e[r]);if(e[r].depth<n)break}return $.none()})(t,e).each(function(e){var t,n;n=e,(t=r).listType=n.listType,t.listAttributes=Ot({},n.listAttributes)})})},Tt=function(e){var t=e,n=function(){return t};return{get:n,set:function(e){t=e},clone:function(){return Tt(n())}}},Dt=function(i,u,a,s){return tt(s).filter(vt).fold(function(){u.each(function(e){Qe(e.start,s)&&a.set(!0)});var t,n,r,e=(t=s,n=i,r=a.get(),Je(t).map(function(e){return{depth:n,isSelected:r,content:St(t),itemAttributes:ct(t),listAttributes:ct(e),listType:at(e)}}));u.each(function(e){Qe(e.end,s)&&a.set(!1)});var o=nt(s).filter(vt).map(function(e){return Lt(i,u,a,e)}).getOr([]);return e.toArray().concat(o)},function(e){return Lt(i,u,a,e)})},Lt=function(t,n,r,e){return ee(Ze(e),function(e){return(vt(e)?Lt:Dt)(t+1,n,r,e)})},Et=tinymce.util.Tools.resolve("tinymce.Env"),kt=function(e,t){var n,r,o,i,u=e.dom,a=e.schema.getBlockElements(),s=u.createFragment();if(e.settings.forced_root_block&&(o=e.settings.forced_root_block),o&&((r=u.create(o)).tagName===e.settings.forced_root_block&&u.setAttribs(r,e.settings.forced_root_block_attrs),T(t.firstChild,a)||s.appendChild(r)),t)for(;n=t.firstChild;){var c=n.nodeName;i||"SPAN"===c&&"bookmark"===n.getAttribute("data-mce-type")||(i=!0),T(n,a)?(s.appendChild(n),r=null):o?(r||(r=u.create(o),s.appendChild(r)),r.appendChild(n)):s.appendChild(n)}return e.settings.forced_root_block?i||Et.ie&&!(10<Et.ie)||r.appendChild(u.create("br",{"data-mce-bogus":"1"})):s.appendChild(u.create("br")),s},wt=function(i,e){return X(e,function(e){var t,n,r,o=(t=e.content,r=(n||document).createDocumentFragment(),Q(t,function(e){r.appendChild(e.dom())}),ve.fromDom(r));return ve.fromDom(kt(i,o.dom()))})},At=function(e,t){return bt(t),(n=e.contentDocument,r=t,o=G(r,function(e,t){return t.depth>e.length?pt(n,e,t):gt(n,e,t)},[]),ne(o).map(function(e){return e.list})).toArray();var n,r,o},xt=function(e){var t,n,r=X(ge.getSelectedListItems(e),ve.fromDom);return he([J(r,_(ht)),J((t=r,n=te.call(t,0),n.reverse(),n),_(ht))],function(e,t){return{start:e,end:t}})},Rt=function(a,e,s){var t,n,r,o=(t=e,n=xt(a),r=Tt(!1),X(t,function(e){return{sourceList:e,entries:Lt(0,n,r,e)}}));Q(o,function(e){var t,n,r,o,i,u;t=e.entries,n=s,Q(Y(t,Nt),function(e){return function(e,t){switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}}(n,e)}),r=e.sourceList,i=a,u=e.entries,o=ee(function(e,t){if(0===e.length)return[];for(var n=t(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var a=e[i],s=t(a);s!==n&&(r.push(o),o=[]),n=s,o.push(a)}return 0!==o.length&&r.push(o),r}(u,yt),function(e){return ne(e).map(yt).getOr(!1)?At(i,e):wt(i,e)}),Q(o,function(e){rt(r,e)}),ut(e.sourceList)})},It=d.DOM,_t=function(e,t,n){var r,o,i,u,a,s;for(i=It.select('span[data-mce-type="bookmark"]',t),a=kt(e,n),(r=It.createRng()).setStartAfter(n),r.setEndAfter(t),u=(o=r.extractContents()).firstChild;u;u=u.firstChild)if("LI"===u.nodeName&&e.dom.isEmpty(u)){It.remove(u);break}e.dom.isEmpty(o)||It.insertAfter(o,t),It.insertAfter(a,t),L(e.dom,n.parentNode)&&(s=n.parentNode,v.each(i,function(e){s.parentNode.insertBefore(e,n.parentNode)}),It.remove(s)),It.remove(n),L(e.dom,t)&&It.remove(t)},Bt=function(e){Ge(e,"DT")&&dt(e,"DD")},Pt=function(r,e,t){Q(t,"Indent"===e?Bt:function(e){return t=r,void(Ge(n=e,"DD")?dt(n,"DT"):Ge(n,"DT")&&Je(n).each(function(e){return _t(t,e.dom(),n.dom())}));var t,n})},Mt=function(e,t){var n=X(ge.getSelectedListRoots(e),ve.fromDom),r=X(ge.getSelectedDlItems(e),ve.fromDom),o=!1;if(n.length||r.length){var i=e.selection.getBookmark();Rt(e,n,t),Pt(e,t,r),e.selection.moveToBookmark(i),e.selection.setRng(w(e.selection.getRng())),e.nodeChanged(),o=!0}return o},Ut=function(e){return Mt(e,"Indent")},Ft=function(e){return Mt(e,"Outdent")},jt=function(e){return Mt(e,"Flatten")},Ht=function(n,e){v.each(e,function(e,t){n.setAttribute(t,e)})},$t=function(e,t,n){var r,o,i,u,a,s,c;r=e,o=t,u=(i=n)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",u),a=e,Ht(s=t,(c=n)["list-attributes"]),v.each(a.select("li",s),function(e){Ht(e,c["list-item-attributes"])})},qt=function(e,t,n,r){var o,i;for(o=t[n?"startContainer":"endContainer"],i=t[n?"startOffset":"endOffset"],1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!n&&O(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(b(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},Wt=function(f,l,d){void 0===d&&(d={});var e,t=f.selection.getRng(!0),m="LI",n=ge.getClosestListRootElm(f,f.selection.getStart(!0)),g=f.dom;"false"!==g.getContentEditable(f.selection.getNode())&&("DL"===(l=l.toUpperCase())&&(m="DT"),e=x(t),v.each(function(n,e,r){for(var o,i=[],u=n.dom,t=qt(n,e,!0,r),a=qt(n,e,!1,r),s=[],c=t;c&&(s.push(c),c!==a);c=c.nextSibling);return v.each(s,function(e){if(b(n,e))return i.push(e),void(o=null);if(u.isBlock(e)||O(e))return O(e)&&u.remove(e),void(o=null);var t=e.nextSibling;p.isBookmarkNode(e)&&(b(n,t)||!t&&e.parentNode===r)?o=null:(o||(o=u.create("p"),e.parentNode.insertBefore(o,e),i.push(o)),o.appendChild(e))}),i}(f,t,n),function(e){var t,n,r,o,i,u,a,s,c;(n=e.previousSibling)&&h(n)&&n.nodeName===l&&(r=n,o=d,i=g.getStyle(r,"list-style-type"),u=o?o["list-style-type"]:"",i===(u=null===u?"":u))?(t=n,e=g.rename(e,m),n.appendChild(e)):(t=g.create(l),e.parentNode.insertBefore(t,e),t.appendChild(e),e=g.rename(e,m)),a=g,s=e,c=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],v.each(c,function(e){var t;return a.setStyle(s,((t={})[e]="",t))}),$t(g,t,d),Kt(f.dom,t)}),f.selection.setRng(R(e)))},zt=function(e,t,n){return s=n,(a=t)&&s&&h(a)&&a.nodeName===s.nodeName&&(i=t,u=n,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(u,"list-style-type",!0))&&(r=n,t.className===r.className);var r,o,i,u,a,s},Kt=function(e,t){var n,r;if(n=t.nextSibling,zt(e,t,n)){for(;r=n.firstChild;)t.appendChild(r);e.remove(n)}if(n=t.previousSibling,zt(e,t,n)){for(;r=n.lastChild;)t.insertBefore(r,t.firstChild);e.remove(n)}},Vt=function(t,e,n,r,o){if(e.nodeName!==r||Xt(o)){var i=x(t.selection.getRng(!0));v.each([e].concat(n),function(e){!function(e,t,n,r){if(t.nodeName!==n){var o=e.rename(t,n);$t(e,o,r)}else $t(e,t,r)}(t.dom,e,r,o)}),t.selection.setRng(R(i))}else jt(t)},Xt=function(e){return"list-style-type"in e},Qt={toggleList:function(e,t,n){var r=ge.getParentList(e),o=ge.getSelectedSubLists(e);n=n||{},r&&0<o.length?Vt(e,r,o,t,n):function(e,t,n,r){if(t!==e.getBody())if(t)if(t.nodeName!==n||Xt(r)){var o=x(e.selection.getRng(!0));$t(e.dom,t,r),Kt(e.dom,e.dom.rename(t,n)),e.selection.setRng(R(o))}else jt(e);else Wt(e,n,r)}(e,r,t,n)},mergeWithAdjacentLists:Kt},Yt=d.DOM,Gt=function(e,t){var n,r=t.parentNode;"LI"===r.nodeName&&r.firstChild===t&&((n=r.previousSibling)&&"LI"===n.nodeName?(n.appendChild(t),L(e,r)&&Yt.remove(r)):Yt.setStyle(r,"listStyleType","none")),h(r)&&(n=r.previousSibling)&&"LI"===n.nodeName&&n.appendChild(t)},Jt=function(t,e){v.each(v.grep(t.select("ol,ul",e)),function(e){Gt(t,e)})},Zt=function(e,t,n,r){var o,i,u=t.startContainer,a=t.startOffset;if(3===u.nodeType&&(n?a<u.data.length:0<a))return u;for(o=e.schema.getNonEmptyElements(),1===u.nodeType&&(u=c.getNode(u,a)),i=new f(u,r),n&&D(e.dom,u)&&i.next();u=i[n?"next":"prev2"]();){if("LI"===u.nodeName&&!u.hasChildNodes())return u;if(o[u.nodeName])return u;if(3===u.nodeType&&0<u.data.length)return u}},en=function(e,t){var n=t.childNodes;return 1===n.length&&!h(n[0])&&e.isBlock(n[0])},tn=function(e,t,n){var r,o,i,u;if(o=en(e,n)?n.firstChild:n,en(i=e,u=t)&&i.remove(u.firstChild,!0),!L(e,t,!0))for(;r=t.firstChild;)o.appendChild(r)},nn=function(t,e,n){var r,o,i=e.parentNode;if(E(t,e)&&E(t,n)){h(n.lastChild)&&(o=n.lastChild),i===n.lastChild&&O(i.previousSibling)&&t.remove(i.previousSibling),(r=n.lastChild)&&O(r)&&e.hasChildNodes()&&t.remove(r),L(t,n,!0)&&t.$(n).empty(),tn(t,e,n),o&&n.appendChild(o);var u=Ye(ve.fromDom(n),ve.fromDom(e))?t.getParents(e,h,n):[];t.remove(e),Q(u,function(e){L(t,e)&&e!==t.getRoot()&&t.remove(e)})}},rn=function(e,t,n,r){var o,i,u,a=e.dom;if(a.isEmpty(r))i=n,u=r,(o=e).dom.$(u).empty(),nn(o.dom,i,u),o.selection.setCursorLocation(u);else{var s=x(t);nn(a,n,r),e.selection.setRng(R(s))}},on=function(e,t){var n,r,o,i=e.dom,u=e.selection,a=u.getStart(),s=ge.getClosestListRootElm(e,a),c=i.getParent(u.getStart(),"LI",s);if(c){if((n=c.parentNode)===e.getBody()&&L(i,n))return!0;if(r=w(u.getRng(!0)),(o=i.getParent(Zt(e,r,t,s),"LI",s))&&o!==c)return t?rn(e,r,o,c):function(e,t,n,r){var o=x(t);nn(e.dom,n,r);var i=R(o);e.selection.setRng(i)}(e,r,c,o),!0;if(!o&&!t)return jt(e),!0}return!1},un=function(e,t){return on(e,t)||function(o,i){var u=o.dom,e=o.selection.getStart(),a=ge.getClosestListRootElm(o,e),s=u.getParent(e,u.isBlock,a);if(s&&u.isEmpty(s)){var t=w(o.selection.getRng(!0)),c=u.getParent(Zt(o,t,i,a),"LI",a);if(c)return o.undoManager.transact(function(){var e,t,n,r;t=s,n=a,r=(e=u).getParent(t.parentNode,e.isBlock,n),e.remove(t),r&&e.isEmpty(r)&&e.remove(r),Qt.mergeWithAdjacentLists(u,c.parentNode),o.selection.select(c,!0),o.selection.collapse(i)}),!0}return!1}(e,t)},an=function(e,t){return e.selection.isCollapsed()?un(e,t):(r=(n=e).selection.getStart(),o=ge.getClosestListRootElm(n,r),!!(n.dom.getParent(r,"LI,DT,DD",o)||0<ge.getSelectedListItems(n).length)&&(n.undoManager.transact(function(){n.execCommand("Delete"),Jt(n.dom,n.getBody())}),!0));var n,r,o},sn=function(t){t.on("keydown",function(e){e.keyCode===l.BACKSPACE?an(t,!1)&&e.preventDefault():e.keyCode===l.DELETE&&an(t,!0)&&e.preventDefault()})},cn=an,fn=function(t){return{backspaceDelete:function(e){cn(t,e)}}},ln=function(t,n){return function(){var e=t.dom.getParent(t.selection.getStart(),"UL,OL,DL");return e&&e.nodeName===n}},dn=function(n){n.on("BeforeExecCommand",function(e){var t=e.command.toLowerCase();"indent"===t?Ut(n):"outdent"===t&&Ft(n)}),n.addCommand("InsertUnorderedList",function(e,t){Qt.toggleList(n,"UL",t)}),n.addCommand("InsertOrderedList",function(e,t){Qt.toggleList(n,"OL",t)}),n.addCommand("InsertDefinitionList",function(e,t){Qt.toggleList(n,"DL",t)}),n.addCommand("RemoveList",function(){jt(n)}),n.addQueryStateHandler("InsertUnorderedList",ln(n,"UL")),n.addQueryStateHandler("InsertOrderedList",ln(n,"OL")),n.addQueryStateHandler("InsertDefinitionList",ln(n,"DL"))},mn=function(e){return e.getParam("lists_indent_on_tab",!0)},gn=function(e){var t;mn(e)&&(t=e).on("keydown",function(e){e.keyCode!==l.TAB||l.metaKeyPressed(e)||t.undoManager.transact(function(){(e.shiftKey?Ft(t):Ut(t))&&e.preventDefault()})}),sn(e)},pn=function(t,i){return function(e){var o=e.control;t.on("NodeChange",function(e){var t=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}(e.parents,C),n=-1!==t?e.parents.slice(0,t):e.parents,r=v.grep(n,h);o.active(0<r.length&&r[0].nodeName===i)})}},vn=function(e){var t,n,r;n="advlist",r=(t=e).settings.plugins?t.settings.plugins:"",-1===v.inArray(r.split(/[ ,]/),n)&&(e.addButton("numlist",{active:!1,title:"Numbered list",cmd:"InsertOrderedList",onPostRender:pn(e,"OL")}),e.addButton("bullist",{active:!1,title:"Bullet list",cmd:"InsertUnorderedList",onPostRender:pn(e,"UL")})),e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent"})};s.add("lists",function(e){return gn(e),vn(e),dn(e),fn(e)})}();